---
title: "NextAuth v5ã§Githubèªè¨¼ã‚„ã£ã¦ã¿ãŸ"
emoji: "ğŸ—ï¸"
type: "tech"
topics: [React, TypeScript, Javascript, Next]
published: true
---

## ã¯ã˜ã‚ã«

NextAuth v5 ã®è¨˜äº‹ãŒå°‘ãªã‹ã£ãŸã®ã§ã€ãƒ¡ãƒ¢ç¨‹åº¦ã§ã™ãŒæ›¸ã„ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚

## ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```
npm install next-auth@beta
```

https://authjs.dev/reference/nextjs#installation

## github OAuthApps è¨­å®š

OAuth èªè¨¼ã®è¨­å®šã‚’ã—ã¾ã™

profile > setting > Developer Settings > OAuth App

Homepage URL

```
http://localhost:3000
```

Authorization callback URL

```
http://localhost:3000/api/auth/callback/github
```

![](/images/github-app.png)
_AuthApp è¨­å®š_

## route ã‚’è¨­å®šã™ã‚‹

api/auth/[...next-auth]
ã“ã®ã‚ˆã†ã«ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã—ã€route.ts ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

å¾Œã»ã©è¨­å®šã™ã‚‹ auth.ts ã‹ã‚‰ handlers ã‚’ import
GET,POST ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©ã—ã¾ã™ã€‚

```ts:api/auth/[...next-auth]/route.ts
import { handlers } from "@/auth/auth";

export const { GET, POST } = handlers;
```

## env ã®è¨­å®š

ä»¥ä¸‹ã®é …ç›®ã‚’è¨­å®šã—ã¦ã„ãã¾ã™ã€‚

```env
AUTH_SECRET=hogehoge

#ä»¥ä¸‹äºŒã¤ã¯OAuthAppsã§è¨­å®šã—ãŸappã®ç”»é¢ã‹ã‚‰æŒã£ã¦ãã¾ã™
GITHUB_CLIENT_ID= hoge
GITHUB_CLIENT_SECRET= hoge
```

:::message
Client secrets ã¯ä½œæˆæ™‚ã«ã—ã‹è¡¨ç¤ºã•ã‚Œãªã„ã®ã§æ³¨æ„
:::

AUTH_SEACRET ã¯ãƒ©ãƒ³ãƒ€ãƒ ãªæ–‡å­—åˆ—ã‚’è¨­å®šã—ã¾ã™
ä»¥ä¸‹ã® URL ã‚’å©ãã¨å®‰å…¨ãªæ–‡å­—åˆ—ãŒç”Ÿæˆã§ãã¾ã™
https://generate-secret.vercel.app/32

## auth.ts è¨˜è¿°

Github ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ã‚’è¨­å®šã—ã€ãã‚Œãã‚Œ export ã—ã¾ã™

```ts:auth.ts
import NextAuth, { NextAuthConfig } from "next-auth";
import GithubProvider from "next-auth/providers/github";

const config: NextAuthConfig = {
  providers: [
    GithubProvider({
      clientId: process.env.GITHUB_CLIENT_ID,
      clientSecret: process.env.GITHUB_CLIENT_SECRET,
    }),
  ],
  basePath: "/api/auth",
};

export const { handlers, auth, signIn, signOut } = NextAuth(config);
```

## ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã—ã¦ã¿ã‚‹

ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã€ã‚µã‚¤ãƒ³ã‚¢ã‚¦ãƒˆç”¨ã®ãƒœã‚¿ãƒ³ã‚’å®šç¾©ã—ã¾ã™

```tsx:auth_button
import { auth, signIn, signOut } from "@/auth/auth";

export async function SignInButton() {
  const session = await auth();
  if (!session?.user)
    return (
      <>
        <form
          action={async () => {
            "use server";
            await signIn();
          }}
        >
          <button type='submit'>Sign in</button>
        </form>
      </>
    );
}

export async function SignOutButton() {
  return (
    <>
      <form
        action={async () => {
          "use server";
          await signOut();
        }}
      >
        <button type='submit'>Sign out</button>
      </form>
    </>
  );
}
```

## ã‚µãƒ³ãƒ—ãƒ«ãƒªãƒã‚¸ãƒˆãƒª

https://github.com/taku10101/next-auth.v5-terminal

## å‚è€ƒæ–‡çŒ®

https://authjs.dev/

https://authjs.dev/getting-started/authentication/oauth?provider=github
